<!--                                                                          -->
<!--                              MODIFICATION LOG                            -->
<!--                                                                          -->
<!--    DATE    VERSION     AUTHOR                 DESCRIPTION                -->
<!-- ---------  --------  -----------    ------------------------------------ -->
<!--            V1.00.00                 Initial                              -->
<!-- 108-12-30  V1.00.01                                                      -->
<!-- 109-08-11  V1.00.02  JustinWu       調整欄位顏色、新增排除名單備註字、檢核條件以及匯入名單         -->
<!--**************************************************************************-->
<html>
<head>
<title>卡人等級參數設定[mcc]-detl</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="css/ecsBank.css" type="text/css">
<script language="JavaScript" src="js/jquery.js"></script>
</head>


<body background="${water_mark}" >
<form name="dataForm"  method="post" action="">

<table border="0" cellpadding="0" cellspacing="0" style="margin-bottom:10px;">
<tr>
 <td width="100">&nbsp;</td>
 <td> 
  <img height="30" src="images/upperLevel.gif" style="cursor:hand;" onClick="top.upperLevel()"; alt="回上層"; />&nbsp;
  <input type="Button" value="讀取" onClick="return top.submitControl('R2')" class="btQuery" >&nbsp;&nbsp;
  <input type="Button" value="存檔" ${btnUpdate_disable} onClick="return top.submitControl('U2')" class="btUpdate" >&nbsp;&nbsp;
  </td>
</tr>
</table>

<div id="dataBlock">
<table width="60%" border="0" cellspacing="0" cellpadding="4">
  <tr>
   <td nowrap class="col_key">計算順序：
      <span class="dsp_text">1</span>
      <input type=hidden name="seq_no" value="1" />
   </td>
   <td nowrap >TABLE_NAME：
      <span class="dsp_text">PTR_VIP_CANCEL</span>
      <input type=hidden name="table_name" value="PTR_VIP_CANCEL" />
   </td>
  </tr>
  <tr>
   <td nowrap>明細類別：
      <span class="dsp_date">A05</span>
      <input type=hidden name="data_type" value="A05" />
   </td>
   <td nowrap class="col_key">已覆核：${apr_flag}
      <input type=hidden name="apr_flag" value="${apr_flag}" />
   </td>
  </tr>
  <tr>
   <td nowrap colspan="2">
      <input type="Button" value="VIP code" onclick="wf_detl_2page('1');" class="btAdd_detl" />
      <input type="Button" value="凍結碼" onclick="wf_detl_2page('2');" class="btAdd_detl" />
      <input type="Button" value="風險分類" onclick="wf_detl_2page('3');" class="btAdd_detl" />
      <input type="Button" value="ACTION CODE"  onclick="wf_detl_2page('4');" class="btAdd_detl" />   
      <input type="Button" value="排除名單" onclick="wf_detl_2page('5');" disabled />                                                                                          
   </td>
</table>

<table width="60%" border="0" cellspacing="0" cellpadding="4">
  <tr>
   <td nowrap >排除名單-身分證ID：
      <input type="text" class="col_text" id="ex_data_code" value="${ex_data_code}" maxlength="10" size="12">
      <input type="text" style="display: none"/>   
     &nbsp;
      <input type="Button" id="detl_btnAdd" value="新增明細" class="btAdd_detl" />
      <input type="Button"  value="匯入排除名單" id="processList" class="btOther" onclick="return uploadClick('A05')">
      &nbsp;IND_NUM=${ind_num}             
   </td>
  </tr>
  <tr>
   <td nowrap colspan="2" class="dsp_remark">注意：「匯入排除名單」會清除原排除名單
   </td>
  </tr>
</table>  
<hr>
<table id="table1" width="60%" border="0" cellspacing="0" cellpadding="4">
 <tr>
    <th nowrap class="list_cc" width="5%">刪除 </th>
    <th nowrap class="list_cc">排除名單-身分證ID </th>
  </tr>
  <!-- BEGIN DYNAMIC : DETAIL -->
  <tr>
    <td nowrap class="list_no" bgcolor="#EFEFEF">
      <span class="dsp_flag">${ok_flag}</span>
    	<input type="checkbox" name="opt" value="${ser_num}">
      ${SER_NUM}
      <input type="hidden" name="ser_num" value="${ser_num}">
      <input type="hidden" name="data_code" value="${data_code}" />
    </td>
    <td nowrap class="list_cc" >&nbsp;${data_code}</td>
  <!-- END DYNAMIC : DETAIL -->
</table>
</div>

<!-- -->
<input type="hidden" name="MOD_PGM" value="ptrm0480">
<input type="hidden" name="HIDE" value="${HIDE_DATA}">
<input type="hidden" name="pageType" value="A05">
<input type="hidden" class="dsp_text"  name="zz_file_name" value="" zEdit="any,canTw" />
<input type="hidden"  name="upload_file" value="" />
<input type="hidden"  name="upload_type" value="" />

</form>
</body>
</html>
<script language="JavaScript" src="js/AJAXFunction_20.js"></script>
<script language="javascript">
var ind=${IND_NUM};
var rowNum=${IND_NUM},colNum=0,fi=0;
</script>

<script language="javascript">
 var isAJAXFinished = true;

 top.refreshButton2('1');
 top.pageRows="999";
 function validateInput() { 
   if ( !top.checkFormat() )
       { return false; }

   return true;
 }
 
  $("#detl_btnAdd").click(function(){

	var ls_data_code =$("#ex_data_code").val().toUpperCase();
	
	if(ls_data_code =='') {
	   alert("指定名單: 不可空白");
	   return ;
	}

   // check idno or corpno is valid
   top.actionCode = "AJAX";

   resetJSON();
     
   addJSON("idnoAJAX",ls_data_code);

   isAJAXFinished = false;

   document.getElementById("ex_data_code").disabled = true;

   processAJAX();

  });


 function ajaxResponse(){
   isAJAXFinished = true;

   document.getElementById("ex_data_code").disabled = false;

   top.respHtml ="ptrm0480_A05";
   top.requHtml ="ptrm0480_A05";

   if( getJson("isIdnoValid") != "Y" ){
    alert("此「身分證字號」不符合格式");
    return;
   }

   var ls_idno = $("#ex_data_code").val().toUpperCase();

   if( isIdnoDuplicate(ls_idno) ){
    alert("此「身分證字號」已重複");
    return;
   }

   rowNum++;
   ind++;
   var serNo ="0";
   if ( ind < 10 )
      { serNo = "0"+ind; }
   else
    { serNo = ""+ind;  }

   $("#table1").append(
      "<tr>"
      +"<td nowrap class='list_no'>"
      +"<input type='checkbox' value='"+serNo+"' name='opt' />"
      +"&nbsp;"+serNo
      +"<input type='hidden' value='"+serNo+"' name='ser_num' />"
      +"<input type='hidden' value='"+ls_idno+"' name='data_code' />"
      +"</td>"
      +"<td nowrap class='list_cc'>"+ls_idno
      +"</td>"
      +"</tr>"
   );

   //-clear-
   $("#ex_data_code").val('');
 }

 function isIdnoDuplicate(idno){
  var idnos = document.getElementsByName("data_code");
  
  for (var i = 0; i < idnos.length; i++) {
    if(idnos[i].value == idno){
      return true;
    }
  }
  return false;
 }


  
 function wf_detl_2page(parm) { 
    top.respLevel = 1;
   if (parm === "1") {
      top.respHtml ="ptrm0480_A01";
   }
   else if (parm === "2") {
      top.respHtml ="ptrm0480_A02";
   }
   else if (parm === "3") {
      top.respHtml ="ptrm0480_A03";
   }
   else if (parm === "4") {
      top.respHtml ="ptrm0480_A04";
   }
   else if (parm === "5") {
      top.respHtml ="ptrm0480_A05";
   }
   else {
      return false;
   }
   top.submitControl("R2");
   return true;
 }

 function uploadClick(data_type){
  document.dataForm.zz_file_name.value = "";

  document.dataForm.data_type.value = data_type;
  
  var parmHtml    = "TarokoUpload";
  var parmName    = "upload_file,zz_file_name";
  var windowSize  = "width=700, height=250, top=100, left=200, resizable=yes";
  top.packageName = "taroko.com";
  top.javaName    = "TarokoUpload";
  top.methodName  = "showScreen";
  top.openWindow("",parmHtml,parmName,windowSize);

  top.packageName = "ptrm02";
  top.javaName    = "Ptrm0480";
  top.requHtml    = "ptrm0480_A05";
  top.respHtml    = "ptrm0480_A05";
  return true;
 }

function wf_uploadAfter(){
  var ss=document.dataForm.zz_file_name.value.trim();
  if (ss.length>0)  top.submitControl('UPLOAD');
}
</script>
