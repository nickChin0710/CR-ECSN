<!--**************************************************************************-->
<!--                                                                          -->
<!--                              MODIFICATION LOG                            -->
<!--                                                                          -->
<!--    DATE    VERSION     AUTHOR                 DESCRIPTION                -->
<!-- ---------  --------  -----------    ------------------------------------ -->
<!-- 109-01-06  V1.00.02  Ru Chen        modify AJAX                          -->
<!--                                                                          -->
<!--**************************************************************************-->
<html>
<head>
<title>郵購/分期付款申購書登錄作業-V.2017-0904-yash-[Initial]</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="css/ecsBank.css" type="text/css">
<link rel="stylesheet" href="js/Calendar/calendar.css">
</head>
<script language="JavaScript" src="js/Calendar/calendar_db.js"></script>
<script language="JavaScript" src="js/jquery.js"></script>
<body background="${water_mark}" >
<form  name="dataForm" method="post" action="" >
<div id="condBlock">
<!--COND -->
<table width="60%" border="0" cellspacing="0" cellpadding="4">
    <tr>
        <td nowrap>&nbsp;申購書編號:&nbsp;
            <input type="text" class="col_any" name="ex_contract_no" value="${ex_contract_no}"
            zEdit="any" maxlength=10 size=10 />
        </td>
         <td nowrap>&nbsp;交易卡號:&nbsp;
            <input type="text" class="col_any" name="ex_card_no" value="${ex_card_no}"
            zEdit="any" maxlength=19 size=19 />
        </td>
    </tr>
    <tr>
        <td nowrap>&nbsp;特店代號:
            <input class="field_style" type="text" name="ex_merchant" size="15" maxlength="15" value="${ex_merchant}" onChange="ItemChange()">&nbsp;&nbsp;
            <input type="Button"  value="..." onclick="processVendorCode()" class="btAdd_detl" />
        </td>
        <td nowrap>&nbsp;商品代號:
            <select style="width:50%" name="ex_product" class="col_ddlb" >
                ${dddw_product}
            </select>
        </td>
    </tr>
    <tr>
        <td nowrap>&nbsp;持卡人身分證號:
            <input type="text" class="col_text" name="ex_idno" value="${ex_idno}" 
			   zEdit="alphanum,upper" maxlength="10" size="12"  />
        </td>
        <td nowrap>&nbsp;選項：
		  <span class="col_radio">
			 <input type="radio" value="1" name="ex_op" ${ex_op-1} />ONUS
			 <input type="radio" value="4" name="ex_op" ${ex_op-4} />NCCC
			 <input type="radio" value="2" name="ex_op" ${ex_op-2} />人工
			 <input type="radio" value="3" name="ex_op" ${ex_op-3}  ${DEFAULT-ex_op}/>全部
		  </span>
		</td>	  
    </tr>
    <tr>
       <td nowrap colspan="2">&nbsp;消費日期：
          <input type="text" class="col_date" name="ex_purchase_date1" value="${ex_purchase_date1}" 
            zEdit="date,yyyymmdd" maxlength="8" size="8" />
          <script language="JavaScript">
            new tcal ({'formname': 'dataForm','controlname': 'ex_purchase_date1'});
          </script>
          --
          <input type="text" class="col_date" name="ex_purchase_date2" value="${ex_purchase_date2}" 
            zEdit="date,yyyymmdd" maxlength="8" size="8" />
          <script language="JavaScript">
            new tcal ({'formname': 'dataForm','controlname': 'ex_purchase_date2'});
          </script>
        </td>
    </tr>
    <tr>
        <td nowrap colspan="2">&nbsp;
            <input type="Button"   value="查詢" onClick="return top.submitControl('Q')" class="btQuery" >&nbsp;&nbsp;
            <input type="Button"   value="清除" onClick="return top.submitControl('L')" class="btClear" >&nbsp;&nbsp;
        </td> 
    </tr>
 </table>
</div>
<hr>
<!-- 動態 BLOCK 視窗控制 -->
<div id="disDiv" class="disScreen"></div>
<div id="popDiv" class="popup1">
    <table id="popup2" style="top:-40px; left:350px; width:300px; height:100px;">
        <tr>
            <td colspan="2"><img onClick="top.hideBlock('popDiv')" src="./images/close_div2.png" /></td>
        </tr>
        <tr>
            <td colspan="2">&nbsp;</td>
        </tr>
        <tr>
            <th nowrap style="width:40%;">特店代號：</th>
            <td nowrap style="width:60%;">
                <select size="1" name="merchant_2" id="merchant_2">
                    ${OPTION_LIST_2}
                </select>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="Button" value=" ok " onClick="top.setBlockValue('ex_merchant','merchant_2'); top.hideBlock('popDiv');ItemChange();" class="btConfirm">
            </td>
        </tr>
    </table>
</div>
<!--List -->
<table id="table1" class="sortable" border="0" cellspacing="0" cellpadding="4">
    <tr>
        <th nowrap class="list_th" width="5%">No&nbsp;</th>
        <th nowrap class="list_th">消費日</th>
        <th nowrap class="list_th">申購書編號</th>
        <th nowrap class="list_th">序號</th>
        <th nowrap class="list_th">類別</th>
        <th nowrap class="list_th">交易卡號</th>
        <th nowrap class="list_th">授權碼</th>
        <th nowrap class="list_th">商品代號</th>
        <th nowrap class="list_th">商品名稱</th>
        <th nowrap class="list_th">EDC</th>
        <th nowrap class="list_th">特店代號</th>
        <th nowrap class="list_th">商品單價</th>
        <th nowrap class="list_th">訂購數量</th>
        <th nowrap class="list_th">兌換券金額</th>
        <th nowrap class="list_th">總金額</th>
        <th nowrap class="list_th">每期金額</th>
        <th nowrap class="list_th">分期付款總期數</th>
        <th nowrap class="list_th">分期付款目前期數</th>
        <th nowrap class="list_th">尾數</th>
        <th nowrap class="list_th">退貨數量</th>
        <th nowrap class="list_th">專款專用旗標</th>
    </tr>
    <!-- BEGIN DYNAMIC : DETAIL -->
    <tr onclick="detailScreen('${SER_NUM}','${contract_no}','${contract_seq_no}','')" style="cursor:hand">
        <td nowrap class="list_no"> ${SER_NUM}&nbsp;</td>
        <td nowrap class="list_ll"> ${purchase_date}</td>
        <td nowrap class="list_ll"> ${contract_no}</td>
        <td nowrap class="list_cc"> ${contract_seq_no} </td>
        <td nowrap class="list_ll"> ${contract_kind} </td>
        <td nowrap class="list_ll"> ${card_no} </td>
        <td nowrap class="list_ll"> ${auth_code} </td>
        <td nowrap class="list_cc"> ${product_no} </td>
        <td nowrap class="list_cc"> ${product_name} </td>
        <td nowrap class="list_cc"> ${cps_flag} </td>
        <td nowrap class="list_ll"> ${mcht_no} </td>
        <td nowrap class="list_rr"> ${tot_amt} </td>
        <td nowrap class="list_rr"> ${qty} </td>
        <td nowrap class="list_rr"> ${exchange_amt} </td>
        <td nowrap class="list_rr"> ${wk_tot_amt} </td>
        <td nowrap class="list_rr"> ${unit_price} </td>
        <td nowrap class="list_rr"> ${install_tot_term} </td>
        <td nowrap class="list_rr"> ${install_curr_term} </td>
        <td nowrap class="list_rr"> ${remd_amt} </td>
        <td nowrap class="list_rr"> ${refund_qty} </td>
        <td nowrap class="list_ll"> ${spec_flag} </td>
    </tr>
    <!-- END DYNAMIC : DETAIL -->
</table>


<input type="hidden"  name="data_k1" value="" >
<input type="hidden"  name="data_k2" value="" >
<input type="hidden"  name="data_k3" value="" >
<input type="hidden"  name="HIDE"  value="${HIDE_DATA}">
<input type="hidden"  name="pageType"  value="cond">

</form>
</body>
</html>
<script language=JavaScript src="js/tigra_tables.js"></script>
<script language="JavaScript" src="js/AJAXFunction_11.js"></script>
<script language="JavaScript">
    tigra_tables('table1', 1, 0, '', '', '#ffcc66', '#cccccc');
</script>
<script language="javascript">

top.refreshButton2('0');
top.pageRows="20";


function validateInput()
{
    if ( !top.checkFormat() )
        { return false; }
    if ( top.actionCode == "X" ) {
        top.respLevel = 1;
        top.respHtml = "bilq0010_detl";
    }
    return true;
}

function detailScreen(serNum,parm,parm2,parm3) { 
    top.respLevel = 1;
    top.currRows  = serNum;
    document.dataForm.data_k1.value = parm;
    document.dataForm.data_k2.value = parm2;
    document.dataForm.data_k3.value = parm3;
    top.respHtml  = "bilq0010_detl";
    top.submitControl('S');
    return true;
}
/* 處理　PUPOP BLOCK */
function processVendorCode() {
    var vendorNo = document.dataForm.ex_merchant.value;

    if (vendorNo.length < 2) { alert("請輸入至少兩碼"); return false; }
    resetJSON();
    autoJSON = false;
    addJSON("ex_merchant", vendorNo);
    top.actionCode = "AJAX";
    //20200106 modify AJAX
    //top.methodName = "actionFunction";
    processAJAX();
    return true;
}

function ajaxResponse() {
    var vendorNo = document.dataForm.ex_merchant.value;
    var vendorList = document.getElementById("merchant_2");

    for (var i = vendorList.length - 1; i >= 0; i--) { vendorList.remove(i); }

    var len = getJSONlength("OPTION_TEXT");
    for (var i = 0; i < len; i++) {
        vendorList.options.add(new Option(getJSONvalue("OPTION_TEXT", i), getJSONvalue("OPTION_VALUE", i)));
        if (vendorList.options[i].value == vendorNo && vendorNo.length > 0) { vendorList.options[i].selected = true; }
    }

    top.popupBlock('popDiv');
}

function ItemChange() {
    top.submitControl('ItemChange');
    return true;
}


</script>
