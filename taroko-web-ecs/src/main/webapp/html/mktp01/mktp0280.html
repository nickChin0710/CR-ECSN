<!--**************************************************************************-->
<!--                                                                          -->
<!--                              MODIFICATION LOG                            -->
<!--                                                                          -->
<!--    DATE    VERSION     AUTHOR                 DESCRIPTION                -->
<!-- ---------  --------  -----------    ------------------------------------ -->
<!-- 111/11/28  V1.00.01  jiangyigndong  updated for project coding standard  -->
<!--**************************************************************************-->
<html>
<head>
    <title> 109/07/28 V1.00.02 Allen Ho Initial 紅利積點兌換電子禮券批號設定作業</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="css/ecsBank.css" type="text/css">
    <link rel="stylesheet" href="js/Calendar/calendar.css">
</head>
<script language="JavaScript" src="js/Calendar/calendar_db.js"></script>

<body background="${water_mark}" >
<form  name="dataForm" method="post" action="" >
    <div id="condBlock">
        <!-- query key *************************************************************-->
        <table width="60%" border="0" cellspacing="0" cellpadding="20">
            <tr>
                <td nowrap>&nbsp;兌換日期:
                    <input type="text" class="col_date"  onChange="columnItemChange('2')"
                           name="ex_tran_date_s" value="${ex_tran_date_s}"
                           zeditType="date,yyyymmdd"  zRequire="K,C" maxlength=8 size=8 />
                    <script language="JavaScript">
                        new tcal ({'formname': 'dataForm','controlname': 'ex_tran_date_s'});
                    </script>
                    --
                    <input type="text" class="col_date"  onChange="columnItemChange('2')"
                           name="ex_tran_date_e" value="${ex_tran_date_e}"
                           zeditType="date,yyyymmdd"  zRequire="K,C" maxlength=8 size=8 />
                    <script language="JavaScript">
                        new tcal ({'formname': 'dataForm','controlname': 'ex_tran_date_e'});
                    </script>
                </td>
                <td nowrap>&nbsp;批號設定日:
                    <input type="text" class="col_date"
                           name="ex_effect_date_s" value="${ex_effect_date_s}"
                           zeditType="date,yyyymmdd"  maxlength=8 size=8 />
                    <script language="JavaScript">
                        new tcal ({'formname': 'dataForm','controlname': 'ex_effect_date_s'});
                    </script>

                    <input type="checkbox" value="N" name="ex_check_flag" ${ex_check_flag-N} >不檢核日期&nbsp;
                </td>
            </tr>
            <tr>
                <td nowrap>&nbsp;供應商代號:
                    <select size="1" name="ex_vendor_no" class="col_ddlb" id="ajaxh_vendor_no"  >
                        ${dddw_vendor_no}
                    </select>
                </td>
                <td nowrap>&nbsp;手機空值顯示：
                    <select  name="ex_cellar_cond" class="col_ddlb"  zRequire="Y" >
                        <option value="N" ${ex_cellar_cond-N} >正常資料</option>
                        <option value="Y" ${ex_cellar_cond-Y} >號碼空值</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td nowrap>&nbsp;含之前未給號：
                    <select  name="ex_bef_cond" class="col_ddlb"  zRequire="Y" >
                        <option value="Y" ${ex_bef_cond-Y} >包含</option>
                        <option value="N" ${ex_bef_cond-N} >不包含</option>
                    </select>
                    批號設定：
                    <select  name="ex_sel_cond" class="col_ddlb"  >
                        <option value=" ">--</option>
                        <option value="Y" ${ex_sel_cond-Y} >已設批號</option>
                        <option value="N" ${ex_sel_cond-N} >未設批號</option>
                    </select>
                </td>
                <td nowrap>&nbsp;
                    <input type="Button" name="btnQuery" value="查詢" onClick="return top.submitControl('Q')" class="btQuery" >&nbsp;&nbsp;
                    <input type="Button" name="btnSetbno" ${btnSetbno_disable}  value="設定批號" onClick="return top.submitControl('procMethod_setbno')" class="btAdd" >&nbsp;&nbsp;
                    <input type="Button" name="btnClear" value="清除" onClick="return top.submitControl('L')" class="btClear" >&nbsp;&nbsp;
                </td>
            </tr>
        </table>
        <hr>
        <table width="60%" border="0" cellspacing="0" cellpadding="20">
            <tr>
                <td nowrap>累計兌換數:　${ex_total_cnt.(999)}
                    <input type="hidden" name="ex_total_cnt" value="${ex_total_cnt}"/>
                    筆
                    　　　累計商品數量:　${ex_ecoupon_cnt.(999)}
                    <input type="hidden" name="ex_ecoupon_cnt" value="${ex_ecoupon_cnt}"/>
                    筆　　　(無手機號碼者不設定批號)
                </td>
            </tr>
        </table>
    </div>
    <!-- browse ************************************************************** -->
    <table id="table1" class="sortable" border="0" cellspacing="0" cellpadding="8">
        <tr>
            <th nowrap class="list_th" width="5%">No&nbsp;</th>
            <th nowrap class="list_th">交易序號</th>
            <th nowrap class="list_th">兌換日期</th>
            <th nowrap class="list_th">身份證號</th>
            <th nowrap class="list_th">姓名</th>
            <th nowrap class="list_th">贈品代碼</th>
            <th nowrap class="list_th">兌換數量</th>
            <th nowrap class="list_th">手機號碼</th>
            <th nowrap class="list_th">電子商品<BR>批號</th>
            <th nowrap class="list_th">商品<BR>生效起日</th>
        </tr>
        <!-- BEGIN DYNAMIC : DETAIL -->
        <tr onclick="detailScreen('${SER_NUM}','${rowid}','','','','')" style="cursor:hand">
            <td nowrap class="list_no">
                ${SER_NUM}&nbsp;
                <input type="hidden" name="ser_num" value="${ser_num}"/>
                <input type="hidden" name="rowid" value="${rowid}"/>
            </td>
            <td nowrap class="list_cc"> ${tran_seqno}
                <input type="hidden" name="tran_seqno" value="${tran_seqno}" />
            </td>
            <td nowrap class="list_cc"> ${tran_date.YMD}
                <input type="hidden" name="tran_date" value="${tran_date}" />
            </td>
            <td nowrap class="list_cc"> ${id_no}${comm_id_no}
                <input type="hidden" name="id_no" value="${id_no}" />
                <input type="hidden" name="comm_id_no" value="${comm_id_no}" />
            </td>
            <td nowrap class="list_ll"> ${chi_name}${comm_chi_name}
                <input type="hidden" name="chi_name" value="${chi_name}" />
                <input type="hidden" name="comm_chi_name" value="${comm_chi_name}" />
            </td>
            <td nowrap class="list_ll"> ${gift_no}
                <input type="hidden" name="gift_no" value="${gift_no}" />
            </td>
            <td nowrap class="list_rr"> ${exchg_cnt.(999)}
                <input type="hidden" name="exchg_cnt" value="${exchg_cnt}" />
            </td>
            <td nowrap class="list_ll"> ${cellar_phone}
                <input type="hidden" name="cellar_phone" value="${cellar_phone}" />
            </td>
            <td nowrap class="list_cc"> ${ecoupon_bno}
                <input type="hidden" name="ecoupon_bno" value="${ecoupon_bno}" />
            </td>
            <td nowrap class="list_cc"> ${ecoupon_date_s.YMD}
                <input type="hidden" name="ecoupon_date_s" value="${ecoupon_date_s}" />
            </td>
            <td nowrap style="visibility:hidden;"> ${id_p_seqno}
                <input type="hidden" name="id_p_seqno" value="${id_p_seqno}" />
            </td>
        </tr>
        <!-- END DYNAMIC : DETAIL -->
    </table>
    <!-- hidden ************************************************************** -->
    <input type="hidden" name="WPROWID" value="${wprowid}">
    <input type="hidden" name="control_tab_name" value="${control_tab_name}" >
    <input type="hidden" name="data_k1" value="" >
    <input type="hidden" name="data_k2" value="" >
    <input type="hidden" name="data_k3" value="" >
    <input type="hidden" name="data_k4" value="" >
    <input type="hidden" name="data_k5" value="" >

    <input type="hidden"  name="HIDE"  value="${HIDE_DATA}">
    <input type="hidden"  name="pageType"  value="cond">

</form>
</body>
<!-- script1 ************************************************************* -->
<script language=JavaScript src="js/tigra_tables.js"></script>
<script language="JavaScript">
    tigra_tables('table1');
</script>
<!00 script2 ************************************************************* -->
<script language="JavaScript" src="js/AJAXFunction_11.js"></script>
<script language="javascript">

    top.refreshButton2('0');
    top.pageRows="20";


    function validateInput()
    {
        if ( !top.checkFormat() )
        { return false; }

        if ( top.actionCode == "X" ) {
            top.respLevel = 1;
            top.respHtml = "mktp0280_detl";
        }
        return true;
    }

    function detailScreen(serNum,parm,parm2,parm3,parm4,parm5)
    {
        top.respLevel = 1;
        top.currRows  = serNum;
        document.dataForm.data_k1.value = parm;
        document.dataForm.data_k2.value = parm2;
        document.dataForm.data_k3.value = parm3;
        document.dataForm.data_k4.value = parm4;
        document.dataForm.data_k5.value = parm5;
        top.respHtml  = "mktp0280_detl";
        top.submitControl('S');
        return true;
    }

    function columnItemChange(ps1)
    {
        var  win_tran_date_s =document.forms["dataForm"]["ex_tran_date_s"].value;
        var  win_tran_date_e =document.forms["dataForm"]["ex_tran_date_e"].value;

        idCode = ps1;
        top.actionCode = "AJAX";
        if ( idCode == '2' )
        {
            clearListObj(document.getElementById("ajaxh_vendor_no"));
            //top.methodName = "wf_ajax_func_2";
            resetJSON();
            addJSON("methodName","wf_ajax_func_2");
            addJSON("ax_win_tran_date_s",win_tran_date_s);
            addJSON("ax_win_tran_date_e",win_tran_date_e);
        }

        processAJAX();
    }

    function ajaxResponse()
    {
        top.respHtml ="mktp0280";

        if (idCode == '2' )
        {
            var listObj = document.getElementById("ajaxh_vendor_no");
            len = getJSONlength("ajaxj_vendor_no");
            for ( var ii=0; ii<len; ii++)
                listObj.options.add(new Option(getJSONvalue("ajaxj_vendor_no",ii)
                    +" "+getJSONvalue("ajaxj_vendor_name",ii)
                    ,getJSONvalue("ajaxj_vendor_no",ii)));
            return false;
        }
    }

    function clearListObj(listObj)
    {
        for( var i = listObj.length - 1; i>=0; i--)
        { listObj.remove(i);  }
    }


</script>
<!-- ******************************************************************** -->
