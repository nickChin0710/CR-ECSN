<html>
<head>
<title>愛金卡黑名單參數維護</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="css/ecsBank.css" type="text/css">
<link rel="stylesheet" href="css/jquery-ui.css" />
<script language="JavaScript" src="js/jquery-2.2.2.min.js"></script>
<script language="JavaScript" src="js/jquery-ui.js"></script>
</head>

<body background="${water_mark}" >
<form name="dataForm"  method="post" action="">
${#PLUGIN:htmcomm_plugin.apr_user}
<table border="0" cellpadding="0" cellspacing="0" style="margin-bottom:10px;">
<tr>
 <td width="100">&nbsp;</td>
 <td>   
  <input type="Button"    value="讀取" onClick="return top.submitControl('R')" class="btQuery" >&nbsp;&nbsp;
  <input type="Button"     value="新增" ${btnAdd_disable}    onClick="return top.submitControl('A')" class="btAdd" >&nbsp;&nbsp;
  <input type="Button"   value="修改" ${btnUpdate_disable} onClick="return top.submitControl('U')" class="btUpdate" >&nbsp;&nbsp;
  <input type="Button"   value="刪除" ${btnDelete_disable} onClick="return top.submitControl('D')" class="btDelete" >&nbsp;&nbsp;
  <input type="Button"    value="清除" onClick="return top.submitControl('L')" class="btClear" >&nbsp;&nbsp;
  </td>
</tr>
</table>
<hr>
<div id="dataBlock">
<table width="80%" border="0" cellspacing="0" cellpadding="4">
  <tr>
		<td nowrap colspan="2" class="td_titl" >愛金卡黑名單參數維護
			<input type="hidden" name="parm_desc" value="愛金卡黑名單參數維護">
		</td>
 </tr>
 <tr>
 	<td nowrap colspan="2" class="td_remark" >&nbsp;**黑名單共同條件為 [非掛失＆未屆期＆ 非黑名單＆無鎖卡日＆無退卡日 ]</td>
 </tr>
 <tr>
 	<td nowrap colspan="2" >&nbsp;
 		<input type="checkbox" name="mcode_cond" value="Y" ${mcode_cond-Y}> MCode >=
 		<input type="text" class="col_text" name="payment_rate" value="${payment_rate}" maxlength="2" size="5" zEdit="number">
 		 且欠款本金 >=
 		<input type="text" class="col_number" name="mcode_amt" value="${mcode_amt}" maxlength="11" size="13" zEdit="number" >
 	</td>
 </tr>
 <tr>
 	<td nowrap colspan="2" >&nbsp;
 		<input type="checkbox" name="block_cond" value="Y" ${block_cond-Y}>
 		<input type="Button" class="btOther"  value="應列黑名單凍結碼" onClick="proc_blockCode()" >
    <input type="text" class="dsp_text"  name="block_reason" value="${block_reason}" readonly />
 	</td>
 </tr>
 <tr>
 	<td nowrap >&nbsp;覆核日期:
 		<span class="dsp_text">${apr_date.YMD}&nbsp;</span>
 		<input type="hidden" name="apr_date" value="${apr_date}">
 	</td>
 	<td nowrap >&nbsp;覆核主管:
 		<span class="dsp_text">${apr_user}&nbsp;</span>
 		<input type="hidden" name="apr_user" value="${apr_user}">
 	</td>
 </tr>
</table>
</div>
<br>
<table width="60%" border="0" cellspacing="1" cellpadding="2" style="margin-left: 30px" >
  <tr>
   <td nowrap class="td_text" width="20%">產生日期：</td>
   <td nowrap class="td_data" width="30%">
      <span class="dsp_date">${crt_date.YMD}</span>
      <input type="hidden" name="crt_date" value="${crt_date}">   
   </td>
   <td nowrap class="td_text" width="20%">產生人員：</td>
   <td nowrap class="td_data" width="30%">
      <span class="dsp_text"> ${crt_user} </span>
      <input type="hidden" name="crt_user" value="${crt_user}">   
   </td>
  </tr>
  <tr>
   <td nowrap class="td_text" width="20%">異動日期：</td>
   <td nowrap class="td_data" width="30%">
      <span class="dsp_date">${mod_date.YMD}</span>
      <input type="hidden" name="mod_date" value="${mod_date}">   
   </td>
   <td nowrap class="td_text" width="20%">異動人員：</td>
   <td nowrap class="td_data" width="30%">
      <span class="dsp_text"> ${mod_user} </span>
      <input type="hidden" name="mod_user" value="${mod_user}">   
   </td>
  </tr>
</table>

<div id="block_dlog"> 
<table border="0" >
 <tr><td>&nbsp;凍結碼:
      <input type=text class="col_text" id="ex_block" value="" 
         zeditType="alphanum,upper" maxlength="2" size="4" /> 
     </td>    
     <td align="right">
     <input type="Button" id="block_btnAdd" value="新增" class="btAdd_detl" />
 </td><tr>
</table>
<hr>
 <table id="tbl_block" border="0" >
  <tr>
    <th nowrap width="5%">刪除 </th>
    <th nowrap >凍結碼 </th>
  </tr>
  <!-- BEGIN DYNAMIC : DETAIL -->
  <tr>
    <td nowrap class="list_no">
      <input type="checkbox" name="opt" value="${ser_num}">
      ${SER_NUM}
      <input type="hidden" name="ser_num" value="${ser_num}">
    </td>
    <td nowrap class="list_cc">&nbsp;${block_code} 
      <input type="hidden" name="block_code" value="${block_code}" />
    </td>
  </tr>
  <!-- END DYNAMIC : DETAIL -->
</table>  
</div>

<!-- -->
<input type="hidden" name="parm_type" value="ICHM0040">
<input type="hidden" name="seq_no" value="0">

<input type="hidden" name="ROWID" value="${rowid}">
<input type="hidden" name="MOD_PGM" value="ichm0030">
<input type="hidden" name="MOD_SEQNO" value="${mod_seqno}">
<input type="hidden" name="HIDE" value="${HIDE_DATA}">
<input type="hidden" name="pageType" value="detl">

</form>
</body>
</html>

<script language="javascript">
var ind1=${IND_NUM1};
var rowNum1=${IND_NUM1};
</script>

<script>
$(document).ready(function () {
     $("#block_dlog").dialog({
         title:'凍結碼',
         autoOpen: false,
         resizable: false,
         modal: true,
         height: 400, width: 300,
         buttons: {
             "確定": function() {
                wf_set_block(document.all.tbl_block);
            	 $(this).dialog("close");
             },
             "取消": function () {
            	 $(this).dialog("close");
             }
         }
     });
   
  $("#block_btnAdd").click(function(){
	var ls_data_code =$("#ex_block").val().toUpperCase().trim();
	if(ls_data_code.length!=2){
	   alert("凍結碼為 2 碼,請重新輸入");
	   return;  
	}

   rowNum1++;
   ind1++;
   var serNo ="0";
   if ( ind1 < 10 )
      { serNo = "0"+ind1; }
   else
   	{ serNo = ""+ind1;  }

   $("#tbl_block").append(
      "<tr>"
      +"<td nowrap class='list_no'>"
      +"<input type='checkbox' value='"+serNo+"' name='opt' />"
      +"&nbsp;"+serNo
      +"<input type='hidden' value='"+serNo+"' name='ser_num' />"
      +"</td>"
      +"<td nowrap class='list_cc'>"+ls_data_code
      +"<input type='hidden' value='"+ls_data_code+"' name='block_code' />"
      +"</td>"
      +"</tr>"
   );

   //-clear-
   $("#ex_block").val('');
  
  });   
     
 });
</script>

<script language="javascript">

 top.refreshButton2('0');
 
 function validateInput()
  {
    if ( !top.checkFormat() )
       { return false; }

    return true;
  }
 
 function proc_blockCode() {
   $("#block_dlog").dialog("open");
 }
 
  function wf_set_block(elmtTable)
 {
	 //debugger;
	 wf_clear_table(elmtTable, false);
	 var tableRows = elmtTable.getElementsByTagName('tr');
    var rowCount = tableRows.length;
    //alert("table1-row="+rowCount);
    var ls_block=""; 
     for (var x=1; x<rowCount; x++) {
       if (tableRows[x].cells.length<2) {
          continue;
       }
    	 var ss = tableRows[x].cells[1].getElementsByTagName("input")[0].value;
       //alert("ss="+ss);
       if(x==1){
       	ls_block +=ss;
       }	else	{
       	ls_block +=","+ss;
       }
       
     }
     $("input[name=block_reason]").val(ls_block);
 } 
 
 function wf_clear_table(elmtTable, bAll)
 {
	 //debugger;
	 var tableRows = elmtTable.getElementsByTagName('tr');
	 var rowCount = tableRows.length;
    //alert("clear-Tab="+rowCount);

	 for (var x=rowCount-1; x>0; x--) {
      //alert("x="+x+", cell="+tableRows[x].cells.length);
      if (tableRows[x].cells.length==0) {
         elmtTable.deleteRow(x);
         continue;
      }
		 if (bAll)
		 { elmtTable.deleteRow(x); }
		 else
		 {
			 var flag = tableRows[x].cells[0].getElementsByTagName("input")[0].checked;
          //alert("xxx="+flag);
         if (flag) {
            elmtTable.deleteRow(x);
         }
		 }
	 }
 }
 
</script>
