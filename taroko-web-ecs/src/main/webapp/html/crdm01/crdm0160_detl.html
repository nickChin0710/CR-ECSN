<html>

<head>
    <title>卡片退件登錄維護作業-detl</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="css/ecsBank.css" type="text/css">
    <link rel="stylesheet" href="js/Calendar/calendar.css">
    <script language="JavaScript" src="js/jquery.js"></script>
</head>
<script language="JavaScript" src="js/Calendar/calendar_db.js"></script>

<body background="${water_mark}">
    <form name="dataForm" method="post" action="">
        <table border="0" cellpadding="0" cellspacing="0" style="margin-bottom:10px;">
            <tr>
                <td width="100">&nbsp;</td>
                <td colspan="4">
                    <img height="30" src="images/upperLevel.gif" style="cursor:hand;" onClick="top.upperLevel()" alt="回上層">&nbsp;
                    <input type="Button"  value="修改" ${btnUpdate_disable} onClick="return top.submitControl('U')" class="btUpdate">&nbsp;&nbsp;
                    <!-- <input type="Button" name="btnClear" value="清除" onClick="return top.submitControl('L')" class="btClear">&nbsp;&nbsp; -->
                </td>
            </tr>
        </table>
        <div id="dataBlock">
            <!-- Detail data================================= -->
            <table width="80%" border="0" cellspacing="0" cellpadding="4">
                <tr>
                    <td nowrap>卡號：
                        <span class="dsp_text">${card_no}</span>
                        <input type="hidden" name="card_no" value="${card_no}">
                    </td>
                    <td nowrap>退卡日期：
                        <span class="dsp_text">${return_date}</span>
                        <input type="hidden" name="return_date" value="${return_date}">
                    </td>
                    <td>退卡編號：
                        <span class="dsp_text">${return_seqno}</span>
                        <input type="hidden" name="return_seqno" value="${return_seqno}">
                    </td>
                </tr>
                <tr>
                    <td nowrap>身份證字號:
                        <span class="dsp_text">${db_id_no}</span>
                        <input type="hidden" name="db_id_no" value="${db_id_no}">
                        <input type="hidden" name="id_no" value="${id_no}" id= "id_no">
                    </td>
                    <td nowrap colspan="2">姓名:
                        <span class="dsp_text" >${chi_name}</span>
                        <input type="hidden" name="chi_name" value="${chi_name}">
                    </td>
                </tr>
                <tr>
                    <td nowrap>晶片旗標:
                        <span class="dsp_text">${ic_flag}</span>
                        <input type="hidden" name="ic_flag" value="${ic_flag}">
                    </td>
                    <td nowrap colspan="2">團體代號：
                        <span class="dsp_text">${db_group_code}</span>
                        <input type="hidden" name="db_group_code" value="${db_group_code}">
                        <input type="hidden" name="group_code" value="${group_code}">
                    </td>
                </tr>
                <tr>
                    <td nowrap>正附卡別:
                        <span class="dsp_text">${db_subflag}</span>
                        <input type="hidden" name="db_subflag" value="${db_subflag}">
                    </td>
                    <td nowrap colspan="2">卡片效期:&nbsp;
                        <span class="dsp_text">${beg_date}</span>
                        --
                        <span class="dsp_text">${end_date}</span>
                        <input type="hidden" name="beg_date" value="${beg_date}">
                        <input type="hidden" name="end_date" value="${end_date}">
                    </td>
                </tr>
                <tr>
                    <td nowrap>退卡性質別:&nbsp;
                        <select size="1" name="return_type" class="col_ddlb" >
                            <option value="">--</option>
                            <option value="1" ${return_type-1}>1.新製卡</option>
                            <option value="2" ${return_type-2}>2.續卡</option>
                            <option value="3" ${return_type-3}>3.重製</option>
                        </select>
                    </td>
                       <td nowrap colspan="2">退卡原因:&nbsp;
                        <select name="reason_code" class="col_ddlb" zRequire ="Y">
                            <option value="">--</option>
                            <option value="01" ${reason_code-01}>01.查無此公司</option>
                            <option value="02" ${reason_code-02}>02.查無此人</option>
                            <option value="03" ${reason_code-03}>03.遷移不明</option>
                            <option value="04" ${reason_code-04}>04.地址欠詳</option>
                            <option value="05" ${reason_code-05}>05.查無此址</option>
                            <option value="06" ${reason_code-06}>06.收件人拒收</option>
                            <option value="07" ${reason_code-07}>07.招領逾期</option>
                            <option value="08" ${reason_code-08}>08.分行退件</option>
                            <option value="09" ${reason_code-09}>09.其他</option>
                            <option value="10" ${reason_code-10}>10.地址改變</option>
                            <option value="11" ${reason_code-11}>11.先寄</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td nowrap>寄件別:&nbsp;
                        <select size="1" id="mail_type" name="mail_type" class="col_ddlb" onChange="mailTypeChg();mailAddrFlagChg();">
                            ${dddw_mail_type}
                        </select>
                        <span id= "db_mail_type" class="dsp_text">${db_mail_type}</span>
                        <input type="hidden" name="db_mail_type" value="${db_mail_type}">
                    </td>
                    <td nowrap colspan="2">寄件分行:&nbsp;
                        <select id="mail_branch" name="mail_branch" class="col_ddlb" onChange="mailBranchChg()">
                            ${dddw_branch}
                        </select>
                        <span id = "db_mail_branch" class="dsp_text">${db_mail_branch}</span>
                        <input type="hidden" name="db_mail_branch" value="${db_mail_branch}">
                    </td>
                </tr>
                <tr>
                    <td nowrap colspan="3">帳單地址:
                        <span class="dsp_text">${db_addr}</span>
                        <input type="hidden" name="db_addr" value="${db_addr}">
                        <input type="hidden" name="bill_sending_zip" value="${bill_sending_zip}">
                        <input type="hidden" name="bill_sending_addr1" value="${bill_sending_addr1}">
                        <input type="hidden" name="bill_sending_addr2" value="${bill_sending_addr2}">
                        <input type="hidden" name="bill_sending_addr3" value="${bill_sending_addr3}">
                        <input type="hidden" name="bill_sending_addr4" value="${bill_sending_addr4}">
                        <input type="hidden" name="bill_sending_addr5" value="${bill_sending_addr5}">
                    </td>
                </tr>
                <tr>
                   <td nowrap>卡片寄送地址註記:
      					<select name="MAIL_ADDR_FLAG" id="mail_addr_flag" class="col_ddlb" onChange="mailAddrFlagChg();" id="mail_addr_flag">
         					<option value="">--</option>
         					<option value="1" ${MAIL_ADDR_FLAG-1} >同戶籍地</option>
         					<option value="2" ${MAIL_ADDR_FLAG-2} >同居住地</option>
         					<option value="3" ${MAIL_ADDR_FLAG-3} >同公司地</option>
      					</select>
   					</td>
                </tr>
                <tr>
                    <td nowrap colspan="3">卡片寄送地址:&nbsp;
                        <span class="dsp_text db_zip_code">${db_zip_code}</span>
                        <select id="zip_code" name="zip_code" class="col_ddlb" onChange="return top.submitControl('C1')">
                            ${dddw_zipcode}
                        </select>&nbsp;
                        <span class="dsp_text db_mail_addr1">${db_mail_addr1}</span>
                        <input type="text" class="col_any" id="mail_addr1" name="mail_addr1" value="${mail_addr1}" zEdit="any,canTW" maxlength="10" size="10" />縣市&nbsp;
                        <span class="dsp_text db_mail_addr2">${db_mail_addr2}</span>
                        <input type="text" class="col_any" id="mail_addr2" name="mail_addr2" value="${mail_addr2}" zEdit="any,canTW" maxlength="10" size="10" />鄉鎮市區&nbsp;
                        <span class="dsp_text db_mail_addr3">${db_mail_addr3}</span>
                        <input type="text" class="col_any" id="mail_addr3" name="mail_addr3" value="${mail_addr3}" zEdit="any,canTW" maxlength="12" size="12" /> 村里
                        <input type="hidden" class="db_zip_code" name="db_zip_code" value="${db_zip_code}">
                        <input type="hidden" class="db_mail_addr1" name="db_mail_addr1" value="${db_mail_addr1}">
                        <input type="hidden" class="db_mail_addr2" name="db_mail_addr2" value="${db_mail_addr2}">
                        <input type="hidden" class="db_mail_addr3" name="db_mail_addr3" value="${db_mail_addr3}">
                    </td>
                </tr>
                <tr>
                    <td nowrap colspan="3">&nbsp;
                        <span class="dsp_text db_mail_addr4">${db_mail_addr4}</span>
                        <input type="text" class="col_any" id="mail_addr4" name="mail_addr4" value="${mail_addr4}" zEdit="any,canTW" maxlength="12" size="12" /> 鄰&nbsp;
                        <span class="dsp_text db_mail_addr5">${db_mail_addr5}</span>
                        <input type="text" class="col_any" id="mail_addr5" name="mail_addr5" value="${mail_addr5}" zEdit="any,canTW" maxlength="50" size="50" />
                        <input type="hidden" class="db_mail_addr4" name="db_mail_addr4" value="${db_mail_addr4}">
                        <input type="hidden" class="db_mail_addr5" name="db_mail_addr5" value="${db_mail_addr5}">
                    </td>
                </tr>
                <tr>
                    <td nowrap>處理結果:&nbsp;
                        <select size="1" id="proc_status" name="proc_status" class="col_ddlb" onChange="check1();mailTypeChg();" zRequire="Y">
                            <option value="" selected >--</option>
                            <option value="1" ${proc_status-1}>1.處理中</option>
                            <option value="2" ${proc_status-2}>2.銷毀</option>
                            <option value="3" ${proc_status-3}>3.寄出</option>
                            <option value="4" ${proc_status-4}>4.申停</option>
                            <option value="5" ${proc_status-5}>5.重製</option>
                            <option value="6" ${proc_status-6}>6.寄出不封裝</option>
                            <option value="7" ${proc_status-7}>7.庫存</option>
                        </select>
                    </td>
                    <td nowrap>退卡重寄日期:&nbsp;
                        <input type="text" class="col_date" id="mail_date" name="mail_date" value="${mail_date}" 
                         zEdit="date,yyyymmdd" maxlength="8" size="8"/>
                        <script language="JavaScript">
                            new tcal ({'formname': 'dataForm','controlname': 'mail_date'});
                        </script>
                    </td>

                    <td nowrap>掛號號碼:&nbsp;
<!--                         <input type="text" name="mail_no" value="${mail_no}"> -->
						<span  class="dsp_text">${mail_no}</span>
                        <input type="hidden" name="mail_no" value="${mail_no}">
                    </td>
                </tr>
                <tr>
                    <td nowrap>產生封裝檔：&nbsp;
                        <span id="package_flag" class="dsp_text">${package_flag}</span>
                        <input type="hidden" name="package_flag" value="${package_flag}">
                    </td>
                    <td nowrap>產生封裝檔日期:&nbsp;
                        <span class="dsp_text">${package_date}</span>
                        <input type="hidden" name="package_date" value="${package_date}">
                    </td>
                    <td nowrap>掛號條碼:&nbsp;
                        <input type="text" name="barcode_num" value="${barcode_num}">
                    </td>
                </tr>
                <tr>
                    <td nowrap colspan="3">退卡備註:&nbsp;
                        <br>
                        <textarea rows=3 cols=70 name="return_note" value="${return_note}" zEdit="any,canTW">${return_note}</textarea>
                    </td>
                </tr>
                </tr>
            </table>
        </div>
        <!-- -->
        <input type="hidden" name="ROWID" value="${rowid}">
        <input type="hidden" name="MOD_PGM" value="crdm0160">
        <input type="hidden" name="MOD_USER" value="${MOD_USER}">
        <input type="hidden" name="MOD_SEQNO" value="${mod_seqno}">
        <input type="hidden" name="HIDE" value="${HIDE_DATA}">
        <input type="hidden" name="pageType" value="detl">
    </form>
</body>

</html>
<script language="JavaScript" src="js/AJAXFunction_11.js"></script>
<script language="javascript">
top.refreshButton2('1');

function validateInput() {
    var proc_status_value = $("#proc_status").val();
    var mail_type = $("#mail_type");
    var mail_branch = $("#mail_branch");
   
    if (!top.checkFormat()) { 
        return false; 
    }
    if (proc_status_value!="3" && proc_status_value!="6") {
        mail_type.children()[0].selected = true;
        mail_branch.children()[0].selected = true;
    }
    return true;
}

function check1() {
    var ss = $("#proc_status").val();
    var s_zip = $('input[name*=bill_sending_zip]').val();
    var s_addr1 = $('input[name*=bill_sending_addr1]').val();
    var s_addr2 = $('input[name*=bill_sending_addr2]').val();
    var s_addr3 = $('input[name*=bill_sending_addr3]').val();
    var s_addr4 = $('input[name*=bill_sending_addr4]').val();
    var s_addr5 = $('input[name*=bill_sending_addr5]').val();
    $("#mail_type").hide();
    $("#mail_branch").hide();
    $("#zip_code").hide();
    $('input[name*=mail_addr1]').hide();
    $('input[name*=mail_addr2]').hide();
    $('input[name*=mail_addr3]').hide();
    $('input[name*=mail_addr4]').hide();
    $('input[name*=mail_addr5]').hide();
    $("#mail_date").hide();
    $("#tcalico_0").hide();
    $("#db_mail_type").show();
    $("#db_mail_branch").show();
    if (ss == "3" || ss == "6") {
        if (ss == "3") {            
            $("#package_flag").text("Y");
            $('input[name*=package_flag]').val("Y");
        } 
        if(ss =="6") {  
            $("#package_flag").text("N");
            $('input[name*=package_flag]').val("N");
        }
        if ($('#zip_code').val() == "") {
            $('#zip_code').val(s_zip);
        }
//         if ($('input[name*=mail_addr1]').val() == "") {
//             $('input[name*=mail_addr1]').val(s_addr1);
//         }
//         if ($('input[name*=mail_addr2]').val() == "") {
//             $('input[name*=mail_addr2]').val(s_addr2);
//         }
//         if ($('input[name*=mail_addr3]').val() == "") {
//             $('input[name*=mail_addr3]').val(s_addr3);
//         }
//         if ($('input[name*=mail_addr4]').val() == "") {
//             $('input[name*=mail_addr4]').val(s_addr4);
//         }
//         if ($('input[name*=mail_addr5]').val() == "") {
//             $('input[name*=mail_addr5]').val(s_addr5);
//         }

        $("#mail_type").show();
        $("#mail_branch").show();
        $("#mail_date").show();
        $("#tcalico_0").show();
        $("#db_mail_type").hide();
        $("#db_mail_branch").hide();

        mailBranchChg();

    }else{

        $("#package_flag").text("N");
        $('input[name*=package_flag]').val("N");
        $("#mail_type").hide();
        $("#mail_branch").hide();
        $('input[name*=mail_type]').val("");
        $('input[name*=mail_branch]').val("");
        $('#zip_code').val("");
        $('input[name*=mail_addr1]').val("");
        $('input[name*=mail_addr2]').val("");
        $('input[name*=mail_addr3]').val("");
        $('input[name*=mail_addr4]').val("");
        $('input[name*=mail_addr5]').val("");
        $('.db_zip_code').val("").text("");
        $('.db_mail_addr1').val("").text("");
        $('.db_mail_addr2').val("").text("");
        $('.db_mail_addr3').val("").text("");
        $('.db_mail_addr4').val("").text("");
        $('.db_mail_addr5').val("").text("");
    } 
    
}

function mailBranchChg(){
  var zip_code = $("#zip_code");
  var mail_addr1 = $("#mail_addr1");
  var mail_addr2 = $("#mail_addr2");
  var mail_addr3 = $("#mail_addr3");
  var mail_addr4 = $("#mail_addr4");
  var mail_addr5 = $("#mail_addr5");
  var dbZipCode = $(".db_zip_code");
  var dbMailAddr1 = $(".db_mail_addr1");
  var dbMailAddr2 = $(".db_mail_addr2");
  var dbMailAddr3 = $(".db_mail_addr3");
  var dbMailAddr4 = $(".db_mail_addr4");
  var dbMailAddr5 = $(".db_mail_addr5");
  var arrAdd = [zip_code, mail_addr1, mail_addr2, mail_addr3, mail_addr4, mail_addr5];
  var arrAdd2 = [dbZipCode, dbMailAddr1, dbMailAddr2, dbMailAddr3, dbMailAddr4, dbMailAddr5];
  var mailBranch = $("select[name = mail_branch] :selected").val();

  if($.trim(mailBranch).length>0){
    for (var i = 0; i < arrAdd.length; i++) {
      ele = arrAdd[i];
      ele.hide();
      ele = arrAdd2[i];
      ele.show();
    }
  }else{
    for (var i = 0; i < arrAdd.length; i++) {
      ele = arrAdd[i];
      if($("#mail_addr_flag").val().length==0){
    	  ele.val("");
  	  }
      ele.show();
      ele = arrAdd2[i];
      ele.hide();
    }
  }
  if (top.actionCode == "U" ) {
	  return true;
  }
   idCode = "1" ;
   top.actionCode = "AJAX";
   resetJSON();
   addJSON("mail_branch",mailBranch);
   processAJAX();

   return true;
 }

 $(document).ready(function() {
	check1();
	mailTypeChg();
	
 });

 function ajaxResponse()
 {
 	top.respHtml ="crdm0160_detl";
 	top.requHtml ="crdm0160_detl";
 	
 	if(getJSONvalue("flag_json",0)==='Y'){
 		var zipCodeJson = getJSONvalue("zip_code_json",0);
 		zipCodeJson != null ? zipCodeJson : "";
 	    $("#zip_code").val(zipCodeJson); 
 		 for(var i= 1 ; i<=5 ; i++ ){
 	       var addr = getJSONvalue("mail_addr" + i + "_json",0);
 	       addr = addr != null ? addr : "";
 	       $("#mail_addr" + i).val(addr);
 	    }
 	}
 	if(getJSONvalue("flag_ajax",0)==='Y'){
 		  var zipCode = getJSONvalue("ajax_zip_code",0);
 		    zipCode != null ? zipCode : "";
 		    $(".db_zip_code").val(zipCode).text(zipCode); 

 		    for(var i= 1 ; i<=5 ; i++ ){
 		        var addr = getJSONvalue("ajax_chi_addr_" + i,0);
 		        addr != null ? addr : "";
 		        $(".db_mail_addr" + i).val(addr).text(addr);
 		    }
 	}
  
 }
 
 function mailAddrFlagChg(){
	  var idNo = $("#id_no").val();
	  var mailAddrflag = $("#mail_addr_flag").val();
	  var mailBranch = $("select[name = mail_branch] :selected").val();
	   top.actionCode = "AJAX";
	   resetJSON();
	   addJSON("id_no_json",idNo);
	   addJSON("mail_addr_flag_json",mailAddrflag);
	   addJSON("mail_branch_json",mailBranch);
	   processAJAX();

	   return true;
	 }
 
 function mailTypeChg(){
	 var mailType = $("#mail_type").val();
	 var procStatus = $('#proc_status').val();
	 if((mailType==='1'||mailType==='2') && (procStatus === '3' || procStatus === '6')){
		 $("#mail_addr_flag").attr("disabled",false);
	 }	else{
		 $("#mail_addr_flag").attr("disabled",true);
		 $("#mail_addr_flag").val("");
	 }
 }
</script>