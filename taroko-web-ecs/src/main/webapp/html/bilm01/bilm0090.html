<!--**************************************************************************-->
<!--                                                                          -->
<!--                              MODIFICATION LOG                            -->
<!--                                                                          -->
<!--    DATE    VERSION     AUTHOR                 DESCRIPTION                -->
<!-- ---------  --------  -----------    ------------------------------------ -->
<!-- 109-01-06  V1.00.02  Ru Chen        modify AJAX                          -->
<!-- 109-11-26  V1.00.03  JustinWu       fix lots of bugs                     -->
<!--**************************************************************************-->
<html>

<head>
    <title>郵購/分期付款商品資料維護作業-V.2020-1126-Justin</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="css/ecsBank.css" type="text/css">
    <script language="JavaScript" src="js/jquery.js"></script>
</head>

<body background="${water_mark}">
    <form name="dataForm" method="post" action="">
        <div id="condBlock">
            <!--COND -->
            <table width="80%" border="0" cellspacing="0" cellpadding="4">
                <tr>
                    <td nowrap colspan=3>&nbsp;特店代號:
                        <input class="field_style" type="text" name="ex_merchant" size="15" maxlength="15" value="${ex_merchant}" onChange = "itemChangeProduct('1');"/>&nbsp;&nbsp;
                        <input type="Button"   value="..." onclick="processVendorCode('merchant')" class="btAdd_detl" />&nbsp;
                    </td>
                    <!-- <td nowrap width="50%">商品代號：&nbsp;
                        <input type="text" class="col_any" name="ex_product_no" value="${ex_product_no}" zEdit="any" maxlength="15" size="15" />
                        <input type="Button"   value="..." onclick="processVendorCode2()" class="btAdd_detl" />
                    </td> -->
                    <td id="pro_no" nowrap colspan=3>&nbsp;商品代號：
                        <select name="ex_prod" id = "product_no" value="${ex_prod}" class="col_ddlb" >
                            ${dddw_product_no}
                        </select>&nbsp;
                    </td>
                    <td nowrap colspan=3>&nbsp;覆核碼:<br>
                        <input type="radio" value="Y" name="ex_apr_flag" ${ex_apr_flag-Y} ${DEFAULT-ex_apr_flag}>(全部:不含新增)<br>
                        <input type="radio" value="N" name="ex_apr_flag" ${ex_apr_flag-N}>未覆核
                    </td>
                    <td nowrap colspan=3>&nbsp;
                        <input type="Button"  value="查詢" onClick="return top.submitControl('Q')" class="btQuery">&nbsp;&nbsp;
                        <input type="Button"   value="清除" onClick="return top.submitControl('L')" class="btClear">&nbsp;&nbsp;
                        <input type="Button"   value="新增" onClick="return top.submitControl('X')" class="btAdd">&nbsp;&nbsp;
                    </td>
                </tr>
            </table>
        </div>
        <!-- 動態 BLOCK 視窗控制 -->
        <!-- <div id="disDiv" class="disScreen"></div> -->
        <div id="popDiv" class="popup1">
            <table id="popup2" style="top:-40px; left:350px; width:300px; height:100px;">
                <tr>
                    <td colspan="2"><img onClick="top.hideBlock('popDiv')" src="./images/close_div2.png" /></td>
                </tr>
                <tr>
                    <td colspan="2">&nbsp;</td>
                </tr>
                <tr>
                    <th nowrap style="width:40%;">特店代號：</th>
                    <td nowrap style="width:60%;">
                        <select size="1" name="merchant_2" id="merchant_2">
                            ${OPTION_LIST_2}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <input type="Button" value=" ok " onClick="top.setBlockValue('ex_merchant','merchant_2'); top.hideBlock('popDiv');mcht_no_focus()" class="btConfirm">
                    </td>
                </tr>
            </table>
        </div>
        <hr>
        <!--List -->
        <table id="table1" class="sortable" border="0" cellspacing="0" cellpadding="4">
            <tr>
                <th nowrap class="list_th" width="5%">No&nbsp;</th>
                <th nowrap class="list_th">特店代號</th>
                <th nowrap class="list_th">商品代號</th>
                <th nowrap class="list_th">商品名稱</th>
                <th nowrap class="list_th">總期數</th>
                <th nowrap class="list_th">每期金額</th>
                <th nowrap class="list_th">尾數</th>
                <th nowrap class="list_th">總金額</th>
                <th nowrap class="list_th">額外費用</th>
                <th nowrap class="list_th">客戶費</th>
                <th nowrap class="list_th">客戶費率</th>
                <th nowrap class="list_th">特店費</th>
                <th nowrap class="list_th">特店費率</th>
                <th nowrap class="list_th">紅利積點抵用</th>
            </tr>
            <!-- BEGIN DYNAMIC : DETAIL -->
            <tr onclick="detailScreen('${SER_NUM}','${mcht_no}','${product_no}','')" style="cursor:hand">
                <td nowrap class="list_no"> ${SER_NUM}&nbsp;</td>
                <td nowrap class="list_ll"> ${mcht_no}</td>
                <td nowrap class="list_ll"> ${product_no} </td>
                <td nowrap class="list_ll"> ${product_name} </td>
                <td nowrap class="list_ll"> ${tot_term} </td>
                <td nowrap class="list_rr"> ${unit_price} </td>
                <td nowrap class="list_rr"> ${remd_amt} </td>
                <td nowrap class="list_rr"> ${tot_amt} </td>
                <td nowrap class="list_ll"> ${extra_fees} </td>
                <td nowrap class="list_rr"> ${clt_fees_fix_amt} </td>
                <td nowrap class="list_ll"> ${clt_interest_rate} </td>
                <td nowrap class="list_rr"> ${fees_fix_amt} </td>
                <td nowrap class="list_ll"> ${interest_rate} </td>
                <td nowrap class="list_ll"> ${against_num} </td>
            </tr>
            <!-- END DYNAMIC : DETAIL -->
        </table>
        <input type="hidden" name="data_k1" value="">
        <input type="hidden" name="data_k2" value="">
        <input type="hidden" name="data_k3" value="">
        <input type="hidden" name="HIDE" value="${HIDE_DATA}">
        <input type="hidden" name="pageType" value="cond">
        <input type="hidden" name="mod_seqno" value="${mod_seqno}">
    </form>
</body>

</html>
<script language=JavaScript src="js/tigra_tables.js"></script>
<script language="JavaScript" src="js/AJAXFunction_11.js"></script>
<script language="JavaScript">
tigra_tables('table1', 1, 0, '', '', '#ffcc66', '#cccccc');
</script>
<script language="javascript">
top.refreshButton2('0');
top.pageRows = "20";

document.dataForm.ex_merchant.focus();

function validateInput() {
    if (!top.checkFormat()) { return false; }
    if (top.actionCode == "X") {
        top.respLevel = 1;
        top.respHtml = "bilm0090_detl";
    }
    return true;
}

function detailScreen(serNum, parm, parm2, parm3) {
    top.respLevel = 1;
    top.currRows = serNum;
    document.dataForm.data_k1.value = parm;
    document.dataForm.data_k2.value = parm2;
    document.dataForm.data_k3.value = parm3;
    top.respHtml = "bilm0090_detl";
    top.submitControl('S');
    return true;
}


function mcht_no_focus() {
    document.dataForm.ex_merchant.focus();
    document.dataForm.ex_prod.focus();

    var mcht = document.dataForm.ex_merchant.value;
    top.submitControl('itemchange');

}
/* 處理　PUPOP BLOCK */
function processVendorCode() {
    var vendorNo = document.dataForm.ex_merchant.value;

    if (vendorNo.length < 2) { alert("請輸入至少兩碼"); return false; }
    resetJSON();
    autoJSON = false;
    addJSON("ex_merchant", vendorNo);
    top.actionCode = "AJAX";
    //20200106 modify AJAX 
    //top.methodName = "actionFunction";
    processAJAX();
    return true;
}

function itemChangeProduct(str){
	
    var merchant2 ;
    if(str == '1'){
        merchant2 = $("input[name=ex_merchant]").val();
    }
    top.actionCode = "AJAX";
    resetJSON();
    addJSON("data_mcht_no",merchant2);
    addJSON("action_code","AJAX1"); 
    processAJAX();
}


	function ajaxResponse() {
		
		if (getJSONvalue("json_action_code", 0) == 'AJAX1') {
			if (getJSONvalue("dddw_tot_term_option", 0) != null) {
				$("#product_no option").remove();
				$("#product_no")
						.append(getJSONvalue("dddw_tot_term_option", 0));
			}
			return true;
		} else {

			var vendorNo = document.dataForm.ex_merchant.value;
			var vendorList = document.getElementById("merchant_2");

			for (var i = vendorList.length - 1; i >= 0; i--) {
				vendorList.remove(i);
			}

			var len = getJSONlength("OPTION_TEXT");
			for (var i = 0; i < len; i++) {
				vendorList.options.add(new Option(
						getJSONvalue("OPTION_TEXT", i), getJSONvalue(
								"OPTION_VALUE", i)));
				if (vendorList.options[i].value == vendorNo
						&& vendorNo.length > 0) {
					vendorList.options[i].selected = true;
				}
			}

			top.popupBlock('popDiv');
		}
	}
</script>