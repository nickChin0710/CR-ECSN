<!--**************************************************************************-->
<!--                                                                          -->
<!--                              MODIFICATION LOG                            -->
<!--                                                                          -->
<!--    DATE    VERSION     AUTHOR                 DESCRIPTION                -->
<!-- ---------  --------  -----------    ------------------------------------ -->
<!-- 109-01-06  V1.00.02  Ru Chen        modify AJAX                          -->
<!--                                                                          -->
<!--**************************************************************************-->
<html>

<head>
    <title>指定卡片預約分期維護作業_detl-V.2019-0820-Amber-[Update]</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="css/ecsBank.css" type="text/css">
    <link rel="stylesheet" href="js/Calendar/calendar.css">
    <script language="JavaScript" src="js/jquery.js"></script>
</head>
<script language="JavaScript" src="js/Calendar/calendar_db.js"></script>

<body background="${water_mark}">
    <form name="dataForm" method="post" action="">
    ${#PLUGIN:htmcomm_plugin.apr_user}
        <table border="0" cellpadding="0" cellspacing="0" style="margin-bottom:10px;">
            <tr>
                <td width="100">&nbsp;</td>
                <td>
                    <img height="30" src="images/upperLevel.gif" style="cursor:hand;" onClick="top.upperLevel()" ; alt="回上層" ;>&nbsp;
                    <input type="Button"   value=" 新增 " ${btnAdd_disable} onClick="return top.submitControl('A')" class="btAdd">&nbsp;&nbsp;
                    <input type="Button"   value=" 修改 " ${btnUpdate_disable} onClick="return top.submitControl('U')" class="btUpdate">&nbsp;&nbsp;
                    <input type="Button"   value=" 刪除 " ${btnDelete_disable} onClick="return top.submitControl('D')" class="btDelete">&nbsp;&nbsp;
                    <input type="Button"   value=" 清除 " onClick="return top.submitControl('L')" class="btClear">&nbsp;&nbsp;
                </td>
            </tr>
        </table>
        <div id="dataBlock">
            <table wid1th="60%" border="0" cellspacing="0" cellpadding="4">
                <!-- 輸入資料讀取條件  -->
                <tr>
                    <td nowrap width="50%">正卡身分證字號：&nbsp;
                        <input type="text" class="col_text" name="id_no" value="${id_no}" zEdit="alphanum,upper" maxlength="10" size="12" onChange="detailIdName(this.value)" zRequire="Y"/>
                        &nbsp;
<!--                         有效卡號 : <span style="background-color:#FFFF33" class="dsp_text2" id="valid_cardno" /> -->
                    </td>
                </tr>
                <tr>
                    <td nowrap>&nbsp;卡號：
                        <select  name="kk_card_no" class="col_ddlb" id="kk_card_no">
        					${dddw_card_no}
      					</select> 
      					<input type="hidden"  name="dddw_card_no" value="${dddw_card_no}">
                    </td>
                </tr>
            </table>
            <hr>
            <!-- Detail data================================= -->
            <table width="60%" border="0" cellspacing="0" cellpadding="4">
                <tr>
                    <td nowrap>預約類別:
                        <select name="reserve_type" class="col_ddlb" onChange="detailReserveType(this.value)">
                   			<option value="1" ${reserve_type-1}>1:稅款(排除綜所稅)</option>
					        <option value="2" ${reserve_type-2}>2.綜所稅</option>
					        <option value="3" ${reserve_type-3}>3:學雜費</option>
					        <option value="4" ${reserve_type-4}>4:保費</option>
                            <input type="hidden" name="reserve_type" value="${reserve_type}" > 
                        </select>
                      <!--  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;放行狀態:
                         <span class="dsp_text">${apr_flag}</span>
                        <input type="hidden" name="apr_flag" id="apr_flag" value="${apr_flag}" />
                        -->
                    </td>
                </tr>
                <tr>
                    <td nowrap>卡號 :
                        <input type="hidden" name="card_no" value="${card_no}" />
                        <span class="dsp_text" id="card_no">${card_no}</span>
                    </td>
                </tr>
                <tr>
                    <td nowrap>消費日 起/迄 :
                        <input type="text" class="col_date" name="start_date" value="${start_date}" zEdit="date,yyyymmdd" maxlength="8" size="8" />
                        <script language="JavaScript">
                            new tcal ({'formname': 'dataForm','controlname': 'start_date'});
                  </script>
                        --
                        <input type="text" class="col_date" name="end_date" value="${end_date}" zEdit="date,yyyymmdd" maxlength="8" size="8" />
                        <script language="JavaScript">
                            new tcal ({'formname': 'dataForm','controlname': 'end_date'});
                  </script>
                    </td>
                </tr>
                <tr>
                    <td nowrap>金額(含以上):
                        <input type="text" class="col_number" name="amt_from" value="${amt_from}" zEdit="number" maxlength=12 size=12 zRequire="Y" />
                        &nbsp;&nbsp;&nbsp;期數:
<!--                         <input type="text" class="col_number" name="installment_term" value="${installment_term}" zEdit="number" maxlength=2 size=2 zRequire="Y" /> -->
							 <select  name="installment_term" class="col_ddlb" id="installment_term" zRequire="Y">
        						 ${dddw_installment_term}
      						 </select> 
      					<input type="hidden"  name="dddw_installment_term" value="${dddw_installment_term}" />
                    </td>
                </tr>
                <tr>
                    <td nowrap>終止:
                    	<span class="col_radio" >
                            <input type="radio" value="" name="break_flag" ${break_flag-} onChange="detailBreakFlag();" />N
                            <input type="radio" value="1" name="break_flag" ${break_flag-Y} onChange="detailBreakFlag();" />Y
                        </span>
<!--                         <select name="break_flag" class="col_ddlb" onChange="detailBreakFlag()" id="break_flag"> -->
<!--                             <option value="" ${break_flag-N}>N</option> -->
<!--                             <option value="1" ${break_flag-Y}>Y</option> -->
<!--                         </select> -->
                        &nbsp;&nbsp;&nbsp;終止日期 :
                        <input type="text" class="col_date" name="break_date" value="${break_date}" zEdit="date,yyyymmdd" maxlength="8" size="8" />
                        <script language="JavaScript">
                            new tcal ({'formname': 'dataForm','controlname': 'break_date'});
                  </script>
                    </td>
                </tr>
            </table>
        </div>
        <br>
        <table width="60%" border="0" cellspacing="1" cellpadding="2" style="margin-left: 30px">
            <tr>
                <td nowrap class="td_text" width="20%">維護人員：</td>
                <td nowrap class="td_data" width="30%">
                    <span class="dsp_text"> ${mod_user} </span>
                    <input type="hidden" name="mod_user" value="${mod_user}">
                </td>
                <td nowrap class="td_text" width="20%">維護日期：</td>
                <td nowrap class="td_data" width="30%">
                    <span class="dsp_date">${mod_date.YMD}</span>
                    <input type="hidden" name="mod_date" value="${mod_date}">
                </td>
            </tr>
            <tr>
                <td nowrap class="td_text" width="20%">覆核人員：</td>
                <td nowrap class="td_data" width="30%">
                    <span class="dsp_text"> ${apr_user} </span>
                    <input type="hidden" name="apr_user" value="${apr_user}">
                </td>
                <td nowrap class="td_text" width="20%">覆核日期：</td>
                <td nowrap class="td_data" width="30%">
                    <span class="dsp_date">${apr_date.YMD}</span>
                    <input type="hidden" name="apr_date" value="${apr_date}">
                </td>
            </tr>
        </table>
        <!-- -->
        <input type="hidden" name="ROWID" value="${rowid}">
        <input type="hidden" name="MOD_PGM" value="bilm0180">
        <input type="hidden" name="USERID" value="${userId}">
        <input type="hidden" name="MOD_SEQNO" value="${mod_seqno}">
        <input type="hidden" name="HIDE" value="${HIDE_DATA}">
        <input type="hidden" name="pageType" value="detl">
    </form>
</body>

</html>
<script language="JavaScript" src="js/AJAXFunction_11.js"></script>
<script language="javascript">
top.refreshButton2('1');

function validateInput() {
    if (!top.checkFormat()) { return false; }

    return true;
}

function detailIdName(id) {

    /*idCode = "2" ; */
    //20200106 modify AJAX
    //top.actionCode = "Q";
    //top.methodName = "itemchanged";
    top.actionCode = "AJAX"
    resetJSON();
    addJSON("ajaxName", "idName");
    addJSON("id", id);
    processAJAX();
    return true;

}


function detailBreakFlag() {

	var flag = $('input[name*=break_flag]:checked').val();
//  alert("break_flag="+flag);
    //20200106 modify AJAX
    //top.actionCode = "Q";
    //top.methodName = "itemchanged";
    top.actionCode = "AJAX"
    resetJSON();
    addJSON("ajaxName", "breakFlag");
    addJSON("flag", flag);

    processAJAX();
    return true;

}

function detailReserveType(reserveType) {

    /*idCode = "2" ; */
    //20200106 modify AJAX
    //top.actionCode = "Q";
    //top.methodName = "itemchanged";
    top.actionCode = "AJAX";
    resetJSON();
    addJSON("ajaxName", "reserveType");
    addJSON("reserveType", reserveType);
    processAJAX();
    return true;

}

function ajaxResponse() {
    top.respHtml = "bilm0180_detl";
    top.requHtml = "bilm0180_detl";
    var ajaxName = getJSONvalue("ajaxName", 0);

    if (ajaxName == "idName") {
        var card_no = getJSONvalue("card_no", 0);
        var kk_card_no = getJSONvalue("kk_card_no", 0);
        var valid_cardno = getJSONvalue("valid_cardno", 0);
        $('#card_no').text(card_no);
        $('input[name=card_no]').val(card_no);
        $('input[name=kk_card_no]').val(kk_card_no);
        $('input[name=valid_cardno]').val(valid_cardno);
        
        if(getJSONvalue("dddw_card_no",0)!=null){
        	
	 		$("#kk_card_no option").remove();
	 		$("#kk_card_no ").append(getJSONvalue("dddw_card_no",0));
	 		$("input[name=dddw_card_no]").val(getJSONvalue("dddw_card_no",0));
		}
        
	}else if (ajaxName == "reserveType") {
    	
    	if (getJSONvalue("dddw_tot_term_option", 0) != null) {
			$("#installment_term option").remove();
			$("#installment_term")
					.append(getJSONvalue("dddw_tot_term_option", 0));
		}
		return true;
    }else{
      var break_date = getJSONvalue("break_date", 0);
      $('input[name=break_date]').val(break_date);
    }

}
</script>